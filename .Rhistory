yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=2)
plot.map(bstfa.bi_1level,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=2)
plot.map(bstfa.tps_16,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=2)
plot.map(bstfa.f_8,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=1)
plot.map(bstfa.bi_1level,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=1)
plot.map(bstfa.tps_16,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=1)
plot.factor(bstfa.f_8,factor=2,include.legend=FALSE)
plot.factor(bstfa.bi_1level,factor=2,include.legend=FALSE)
plot.factor(bstfa.tps_16,factor=2,include.legend=FALSE)
mean(abs(preds.f_8 - preds.tps_16))
5004/4
1252+1251
preds.f_8 = predictBSTFA(bstfa.f_8,type='mean')[1252:2503]
f_tps_16 = apply(bstfa.tps_16$F.tilde,2,mean)[1252:2503]
length(f_tps_16)
f_tps_16 = apply(bstfa.tps_16$F.tilde,2,mean)[1252:2502]
f_f_8 = apply(bstfa.f_8$F.tilde,2,mean)[1252:2502]
f_bi_1level = apply(bstfa.bi_1level$F.tilde,2,mean)[1252:2502]
mean(abs(f_f_8 - f_bi_1level))
mean(abs(f_f_8 - f_tps_16))
mean(abs(f_bi_1level - f_tps_16))
plot(f_f_8,x=bstfa.f_8$doy)
plot(f_f_8,x=bstfa.f_8$doy,type='l')
plot(f_f_8,x=bstfa.f_8$dates,type='l')
plot(f_f_8,x=bstfa.f_8$dates,type='l')
lines(f_bi_1level)
lines(f_bi_1level,x=bstfa.f_8$dates)
plot(f_f_8,x=bstfa.f_8$dates,type='l')
lines(f_bi_1level,x=bstfa.f_8$dates)
lines(f_tps_16,x=bstfa.f_8$dates)
plot(f_f_8,x=bstfa.f_8$dates,type='l',col='red',ylim=c(-4,4))
plot(f_f_8,x=bstfa.f_8$dates,type='l',col='red',ylim=c(-4,4))
lines(f_bi_1level,x=bstfa.f_8$dates,col='blue')
lines(f_tps_16,x=bstfa.f_8$dates,col='green')
plot(f_f_8,x=bstfa.f_8$dates,type='l',col='red',
ylim=c(-4,4),
xlab="Dates",
ylab="Factor Value")
plot(f_f_8,x=bstfa.f_8$dates,type='l',col='red',
ylim=c(-4,4),
xlab="Dates",
ylab="Factor Value")
lines(f_bi_1level,x=bstfa.f_8$dates,col='blue')
lines(f_tps_16,x=bstfa.f_8$dates,col='green')
legend('topleft',legend=c('Fourier','Bisquare','TPS'),
col=c('red','blue','green'),
lty=1)
plot(f_f_8,x=bstfa.f_8$dates,type='l',col='red',
ylim=c(-4,4),
xlab="Dates",
ylab="Factor Value",
main="Factor 2")
lines(f_bi_1level,x=bstfa.f_8$dates,col='blue')
lines(f_tps_16,x=bstfa.f_8$dates,col='green')
legend('topleft',legend=c('Fourier','Bisquare','TPS'),
col=c('red','blue','green'),
lty=1)
devtools::load_all()
plot.map(bstfa.f_8,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=2)
plot.map(bstfa.bi_1level,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=2)
plot.map(bstfa.tps_16,
parameter='loading',
yearscale=TRUE,
type='mean',
map=TRUE,
state=TRUE,
location='utah',
fine=100,
loading=2)
?BSTFA
devtools::load_all()
utahDataList$Dates
utahDataList$Dates[1251]
i=1
y = utahDataList$TemperatureVals[,i]
y
is.na(y)
mean(is.na(h))
mean(is.na(y))
missing = rep(0,146)
missing = rep(0,146)
for (i in 1:146) {
y = utahDataList$TemperatureVals[,i]
missing[i] = mean(is.na(y))
}
missing
mean(missing)
c(min(missing),max(missing))
utahDataList$Locations
moab = ymat[,89]
can = ymat[,20]
moab = utahDataList$TemperatureVals[,89]
can = utahDataList$TemperatureVals[,20]
plot(moab)
plot(moab,type='l')
plot(y=moab,x=utahDataList$Coords,type='l')
plot(y=moab,x=utahDataList$Dates,type='l')
plot(y=can,x=utahDataList$Dates,type='l')
plot(y=moab,x=utahDataList$Dates,type='l',
ylim=c(-20,20))
plot(y=can,x=utahDataList$Dates,type='l',
ylim=c(-20,20))
par(mfrow=c(2,1))
plot(y=moab,x=utahDataList$Dates,type='l',
ylim=c(-20,20))
plot(y=can,x=utahDataList$Dates,type='l',
ylim=c(-20,20))
par(mfrow=c(1,2))
par(mfrow=c(1,2))
plot(y=moab,x=utahDataList$Dates,type='l',
ylim=c(-20,20))
plot(y=can,x=utahDataList$Dates,type='l',
ylim=c(-20,20))
window=1000:1050
par(mfrow=c(1,2))
plot(y=moab[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
plot(y=can[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
window=1000:1100
par(mfrow=c(1,2))
plot(y=moab[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
plot(y=can[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
window=950:1000
par(mfrow=c(1,2))
plot(y=moab[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
plot(y=can[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
window=900:950
par(mfrow=c(1,2))
plot(y=moab[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
plot(y=can[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
window=850:900
par(mfrow=c(1,2))
plot(y=moab[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
plot(y=can[window],x=utahDataList$Dates[window],type='l',
ylim=c(-20,20))
n.temp.bases = 6
n.times = 1251
freq.temp = 1251
m.fft <- sapply(1:(n.temp.bases/2), function(k) {
sin_term <- sin(2 * pi * k * (1:n.times)/freq.temp)
cos_term <- cos(2 * pi * k * (1:n.times)/freq.temp)
cbind(sin_term, cos_term)
})
QT <- cbind(m.fft[1:n.times,], m.fft[(n.times+1):(2*n.times),])
plot(QT[,1])
QT <- cbind(m.fft[1:n.times,], m.fft[(n.times+1):(2*n.times),])
par(mfrow=c(3,2))
for (i in 1:6) {
plot(QT[,i],
xlab="",
ylab="",
main=paste("r=",i,sep=""))
}
par(mfrow=c(2,3))
for (i in 1:6) {
plot(QT[,i],
xlab="",
ylab="",
main=paste("r=",i,sep=""))
}
n.temp.bases = 6
n.times = 1251
freq.temp = 1251
m.fft <- sapply(1:(n.temp.bases/2), function(k) {
sin_term <- sin(2 * pi * k * (1:n.times)/freq.temp)
cos_term <- cos(2 * pi * k * (1:n.times)/freq.temp)
cbind(sin_term, cos_term)
})
QT <- cbind(m.fft[1:n.times,], m.fft[(n.times+1):(2*n.times),])
par(mfrow=c(2,3))
ints = c(seq(1,n.temp.bases,by=2),seq(2,n.temp.bases,by=2))
for (i in 1:6) {
plot(QT[,i],
xlab="",
ylab="",
main=paste("r=",ints[i],sep=""))
}
n.temp.bases = 6
n.times = 1251
freq.temp = 200
m.fft <- sapply(1:(n.temp.bases/2), function(k) {
sin_term <- sin(2 * pi * k * (1:n.times)/freq.temp)
cos_term <- cos(2 * pi * k * (1:n.times)/freq.temp)
cbind(sin_term, cos_term)
})
QT <- cbind(m.fft[1:n.times,], m.fft[(n.times+1):(2*n.times),])
par(mfrow=c(2,3))
ints = c(seq(1,n.temp.bases,by=2),seq(2,n.temp.bases,by=2))
for (i in 1:6) {
plot(QT[,i],
xlab="",
ylab="",
main=paste("r=",ints[i],sep=""))
}
n.temp.bases = 6
n.times = 1251
freq.temp = 1251
m.fft <- sapply(1:(n.temp.bases/2), function(k) {
sin_term <- sin(2 * pi * k * (1:n.times)/freq.temp)
cos_term <- cos(2 * pi * k * (1:n.times)/freq.temp)
cbind(sin_term, cos_term)
})
QT <- cbind(m.fft[1:n.times,], m.fft[(n.times+1):(2*n.times),])
par(mfrow=c(2,3))
ints = c(seq(1,n.temp.bases,by=2),seq(2,n.temp.bases,by=2))
for (i in 1:6) {
plot(QT[,i],
xlab="",
ylab="",
main=paste("r=",ints[i],sep=""))
}
QT <- cbind(m.fft[1:n.times,], m.fft[(n.times+1):(2*n.times),])
par(mfrow=c(2,3))
ints = c(seq(1,n.temp.bases,by=2),seq(2,n.temp.bases,by=2))
for (i in 1:6) {
m = ifelse(i%%2==0,"", paste("r=",ints[i],sep=""))
plot(QT[,i],
xlab="",
ylab="",
main=m)
}
i=3
i%%2==0
paste("r=",ints[i],sep="")
ints = c(seq(1,n.temp.bases,by=2),seq(2,n.temp.bases,by=2))
for (i in 1:6) {
m = ifelse(i%%2==0,"", paste("r=",i,sep=""))
plot(QT[,i],
xlab="",
ylab="",
main=m)
}
ints
n.temp.bases/2
for (i in 1:n.temp.bases) {
m = ifelse(i<=n.temp.bases/2,"", paste("r=",ints[i],sep=""))
plot(QT[,i],
xlab="",
ylab="",
main=m)
}
for (i in 1:n.temp.bases) {
m = ifelse(i>n.temp.bases/2,"", paste("r=",ints[i],sep=""))
plot(QT[,i],
xlab="",
ylab="",
main=m)
}
devtools::load_all()
plot.fourier.bases(coords=utahDataList$Coords,
R=6)
plot.fourier.bases(coords=utahDataList$Coords,
R=6,plot.3d=TRUE)
devtools::load_all()
plot.fourier.bases(coords=utahDataList$Coords,
R=6,plot.3d=TRUE)
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
factors.fixed = c(144,89,129,78),
knot.levels=1,
plot.knots=FALSE,
verbose=FALSE,
iters=1000,
burn=20,
n.temp.bases = 200,
thin=2)
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
factors.fixed = c(144,89,129,78),
knot.levels=1,
plot.knots=FALSE,
verbose=FALSE,
iters=1000,
burn=20,
n.temp.bases = 200,
thin=2,
verbose=TRUE)
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
factors.fixed = c(144,89,129,78),
knot.levels=1,
plot.knots=FALSE,
verbose=TRUE,
iters=1000,
burn=20,
n.temp.bases = 200,
thin=2)
computation.summary(bstfa.output)
devtools::load_all()
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
n.spatial.bases=8,
factors.fixed = c(144,89,129,78),
verbose=TRUE,
iters=100,
burn=20,
n.temp.bases = 126,
thin=2)
computation.summary(bstfa.output)
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
n.spatial.bases=20,
factors.fixed = c(144,89,129,78),
verbose=TRUE,
iters=100,
burn=20,
n.temp.bases = 126,
thin=2)
computation.summary(bstfa.output)
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
n.load.bases=50,
factors.fixed = c(144,89,129,78),
verbose=TRUE,
iters=100,
burn=20,
n.temp.bases = 126,
thin=2)
computation.summary(bstfa.output)
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
n.load.bases=50,
n.spatial.bases=50,
factors.fixed = c(144,89,129,78),
verbose=TRUE,
iters=100,
burn=20,
n.temp.bases = 126,
thin=2)
bstfa.output = BSTFA(ymat=utahDataList$TemperatureVals,
dates=utahDataList$Dates,
coords=utahDataList$Coords,
spatial.style='fourier',
load.style='fourier',
n.load.bases=50,
n.spatial.bases=20,
factors.fixed = c(144,89,129,78),
verbose=TRUE,
iters=100,
burn=20,
n.temp.bases = 126,
thin=2)
computation.summary(bstfa.output)
1000*4.5
4500/60
5200/60
1000*0.094
/60
?c
8/
2
8/3
ceiling(8/3)
5 %% floor(1000/100)
floor(1000/100)
6 %% floor(1000/100)
10 %% floor(1000/100)
9 %% floor(1000*.1)
10 %% floor(1000*.1)
50 %% floor(1000*.1)
100 %% floor(1000*.1)
200 %% floor(1000*.1)
199 %% floor(1000*.1)
199 %% floor(999*.1)
floor(999*.1)
99 %% floor(999*.1)
99*2 %% floor(999*.1)
99*2
198 %% floor(999*.1)
location='california'
map_data_loc <- ggplot2::map_data('state')[ggplot2::map_data('state')$region == location,]
full_map = ggplot2::map_data('state')
predloc <- expand.grid(seq(min(map_data_loc[,1]),
max(map_data_loc[,1]), length=fine),
seq(min(map_data_loc[,2]),
max(map_data_loc[,2]), length=fine))
fine=100
predloc <- expand.grid(seq(min(map_data_loc[,1]),
max(map_data_loc[,1]), length=fine),
seq(min(map_data_loc[,2]),
max(map_data_loc[,2]), length=fine))
dim(predloc)
head(predloc)
names(predloc) <- c("Lon", "Lat")
out$freq.lon
max_value = max(abs(min(predloc.inside$predm)),abs(max(predloc.inside$predm)))
m = ggplot() +
## First layer: worldwide map
geom_polygon(data = full_map,
aes(x=long, y=lat, group = group),
color = '#9c9c9c', fill = '#f3f3f3') +
## Second layer: Country map
geom_polygon(data = map_data_loc,
aes(x=long, y=lat, group = group),
color = 'red', fill='gray') +
coord_map() +
coord_fixed(1.3,
xlim = c(min(out$coords[,1])-1, max(out$coords[,1])+1),
ylim = c(min(out$coords[,2])-1, max(out$coords[,2])+1)) +
ggtitle(plot.title) + # FIX ME
theme(panel.background =element_rect(fill = rgb(.05, .1, 1, .1))) +
geom_point(data=predloc.inside, aes(x=Lon, y=Lat, color=predm)) +
scale_colour_gradientn(colours=color.gradient, name=legend.name,
limits = c(min_value, max_value)) +
# limits = c(-0.7, 0.7)) + # FIX ME
xlab('Longitude') +
ylab('Latitude')
sf_polygon <- sf::st_sfc(sf::st_polygon(list(as.matrix(map_data_loc[,c(1,2)]))), crs=4326)
sf_polygon <- sf::st_make_valid(sf_polygon)
173/256
216/256
230/256
??waic
?polygon
RColorBrewer::brewer.pal(out$n.factors, 'Dark2')
RColorBrewer::brewer.pal(4, 'Dark2')
mycols <- RColorBrewer::brewer.pal(out$n.factors, 'Dark2')
mycols <- RColorBrewer::brewer.pal(4, 'Dark2')
mycolssee <- paste0(mycols, "20")
mycols
mycolssee
